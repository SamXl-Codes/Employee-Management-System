{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900 pt-16">
    
    <!-- Header -->
    <div class="px-6 py-8 border-b border-gray-200 dark:border-gray-700">
        <div class="flex items-center justify-between max-w-[2000px] mx-auto">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Settings</h1>
                <p class="text-gray-600 dark:text-gray-400 mt-1">Manage your system</p>
            </div>
            <div class="flex items-center space-x-3">
                <span class="text-sm text-gray-700 dark:text-gray-300">{{ user.username }}</span>
                <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">
                    {{ user.username[0].upper() }}
                </div>
            </div>
        </div>
    </div>

    <!-- Stats -->
    <div class="px-6 py-6 border-b border-gray-200 dark:border-gray-700">
        <div class="grid grid-cols-4 gap-6 max-w-[2000px] mx-auto">
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Employees</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mt-1">{{ stats.total_employees }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Present Today</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mt-1">{{ stats.active_today }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Pending Requests</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mt-1">{{ stats.pending_leaves }}</p>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Departments</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white mt-1">{{ stats.total_departments }}</p>
            </div>
        </div>
    </div>

    <!-- Content -->
    <div class="px-6 py-8">
        <div class="max-w-[2000px] mx-auto">
            
            <!-- Main Grid -->
            <div class="grid grid-cols-3 gap-6 mb-8">
                
                <!-- User Management -->
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">User Management</h2>
                    <div class="space-y-2">
                        <a href="{{ url_for('employees') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Manage Employees
                        </a>
                        <button onclick="bulkUserOperation()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Bulk Operations
                        </button>
                        <a href="{{ url_for('roles') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Roles & Permissions
                        </a>
                    </div>
                </div>

                <!-- Attendance -->
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Attendance</h2>
                    <div class="space-y-2">
                        <a href="{{ url_for('attendance') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Mark Attendance
                        </a>
                        <a href="{{ url_for('admin_qr_checkin') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            QR Code System
                        </a>
                        <a href="{{ url_for('leave_requests') }}" class="flex items-center justify-between px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            <span>Leave Approvals</span>
                            {% if stats.pending_leaves > 0 %}
                            <span class="bg-red-500 text-white text-xs px-2 py-1 rounded-full">{{ stats.pending_leaves }}</span>
                            {% endif %}
                        </a>
                        <button onclick="bulkAttendanceUpdate()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Bulk Corrections
                        </button>
                    </div>
                </div>

                <!-- System -->
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">System & Data</h2>
                    <div class="space-y-2">
                        <a href="{{ url_for('import_employees') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Import CSV
                        </a>
                        <button onclick="exportDatabase()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Export Data
                        </button>
                        <a href="{{ url_for('reports') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Reports
                        </a>
                        <a href="{{ url_for('audit_logs') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Audit Logs
                        </a>
                    </div>
                </div>
            </div>

            <!-- Secondary -->
            <div class="grid grid-cols-2 gap-6 mb-8">
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Organization</h2>
                    <div class="space-y-2">
                        <a href="{{ url_for('departments') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Departments
                        </a>
                        <a href="{{ url_for('roles') }}" class="block px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Roles
                        </a>
                    </div>
                </div>

                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Security</h2>
                    <div class="space-y-2">
                        <button onclick="changeAdminPassword()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Change Password
                        </button>
                        <button onclick="manageAdminAccess()" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                            Access Control
                        </button>
                    </div>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="border-2 border-red-500 rounded-lg p-6">
                <h2 class="text-lg font-bold text-red-600 mb-2">Danger Zone</h2>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Destructive actions that cannot be undone</p>
                <div class="flex gap-3">
                    <button onclick="confirmAction('clear-all-attendance')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                        Clear Attendance
                    </button>
                    <button onclick="confirmAction('reset-database')" class="px-4 py-2 bg-red-700 text-white rounded-lg hover:bg-red-800">
                        Reset Database
                    </button>
                    <button onclick="confirmAction('purge-inactive')" class="px-4 py-2 bg-red-800 text-white rounded-lg hover:bg-red-900">
                        Purge Inactive
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<script>
function bulkUserOperation() {
    alert('Bulk User Operations feature - will be implemented');
}

function bulkAttendanceUpdate() {
    alert('Bulk Attendance Corrections feature - will be implemented');
}

function exportDatabase() {
    alert('Database export feature - will be implemented');
}

function changeAdminPassword() {
    const newPass = prompt('Enter new password (min 8 characters):');
    if (newPass && newPass.length >= 8) {
        alert('Password change will be implemented with backend');
    } else if (newPass) {
        alert('Password must be at least 8 characters');
    }
}

function manageAdminAccess() {
    alert('Admin Access Control feature - will be implemented');
}

function confirmAction(action) {
    const messages = {
        'clear-all-attendance': 'DELETE ALL attendance records',
        'reset-database': 'RESET THE ENTIRE DATABASE',
        'purge-inactive': 'PERMANENTLY DELETE all inactive users'
    };
    
    if (confirm(`⚠️ WARNING: You are about to ${messages[action]}.\n\nThis CANNOT be undone!\n\nClick OK to continue.`)) {
        const confirm2 = prompt('Type YES to confirm:');
        if (confirm2 === 'YES') {
            alert('Action will be implemented with proper backend validation');
        }
    }
}
</script>

{% endblock %}
